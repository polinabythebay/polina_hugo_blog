
<!DOCTYPE html>


<html class="no-js" lang="en">
<head>
<meta charset="utf-8">
<title>Day 27: Automatically testing changes in state! Visualizing my Git workflow! Floats! - Polina Soshnin</title>
<meta name="author" content="Julia Evans">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="description" content="Day 27: Automatically testing changes in state! Visualizing my Git workflow! Floats!">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="canonical" href="https://jvns.ca/blog/2013/11/13/day-27-magic-testing-functions/">
<link href="/favicon.ico" rel="icon">
<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
<link href="/atom.xml" rel="alternate" title="Julia Evans" type="application/atom+xml">
 
<link href="https://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='https://fonts.googleapis.com/css?family=Montserrat:700,400' rel='stylesheet' type='text/css'>
<link href='https://fonts.googleapis.com/css?family=Alegreya:400,900,700' rel='stylesheet' type='text/css'>
</head>
<body>
<div id="wrap">
<header role="banner">
<hgroup>
<h1><a href="/">Polina Soshnin</a></h1>
</hgroup>
<ul class="header-links">
<span><li><a href="/about">About</a></li>
<li><a href="/projects">Projects</a></li></span>
    <li><a href="https://github.com/polinadotio">Github</a></li></span>
    <li><a href="https://www.linkedin.com/in/polinasoshnin">LinkedIn</a></li></span>
</ul>
</header>
<nav role="navigation" class="header-nav"><ul class="main-navigation">
<li><a href="/categories/favorite/">Favorites</a></li>
<li><a href="/zines">Zines</a></li>
</ul>
</nav>
<div id="main">
<div id="content">

<div>
<article class="hentry" role="article">
<header>
<h1 class="entry-title">Day 27: Automatically testing changes in state! Visualizing my Git workflow! Floats!</h1>

<div class="post-tags">
  
  •
  
    <a class="post-tag" href="/categories/hackerschool">hackerschool</a> 	•
  
  
</div>
<p class="meta">
<time datetime="2013-11-13T00:00:00" pubdate data-updated="true"></time>
</p>
</header>
<div class="entry-content">
     <p>##Testing state changes! (overriding <code>__setattr__</code>)</p>

<p>This morning I worked with <a href="http://akaptur.github.io/">Allison</a>, one of the HS
facilitators. I have previously mentioned that Allison is amazing &ndash; she&rsquo;s
working on this super fun Python bytecode interpreter
called <a href="https://github.com/nedbat/byterun">byterun</a> that
I <a href="http://jvns.ca/blog/2013/10/14/day-9-bytecode-is-made-of-bytes/">blogged about a few weeks ago</a>.</p>

<p>Today we worked a bit on testing this TCP client that I&rsquo;m writing. As a
connection happens, the client goes through a series of internal states
(<code>&quot;CLOSED&quot;</code>, <code>&quot;SYN-SENT&quot;</code>, <code>&quot;ESTABLISHED&quot;</code>, etc.), and I wanted to check
that it was going through the right states.</p>

<p>Allison had the amazing idea of subclassing my socket class to log every
time I set the <code>state</code> attribute. Here&rsquo;s what that looks like:</p>

<pre><code>from tcp import TCPSocket

class LoggingTCPSocket(TCPSocket):
    def __init__(self, listener, verbose=0):
        self.received_packets = []
        self.states = []
        super(self.__class__, self).__init__(listener, verbose)

    def handle(self, packet):
        self.received_packets.append(packet)
        super(self.__class__, self).handle(packet)

    def __setattr__(self, attr, value):
        if attr == 'state':
            self.states.append(value)
        super(self.__class__, self).__setattr__(attr, value)
</code></pre>

<p>So we override <code>__setattr__</code> to log the value every time we change
<code>self.state</code>. This also made me want to learn Python 3 &ndash; apparently this
<code>super()</code> business is much nicer is Python 3.</p>

<p>This means I can then write a test saying</p>

<pre><code>assert conn.states == [&quot;CLOSED&quot;, &quot;SYN-SENT&quot;, &quot;ESTABLISHED&quot;, &quot;LAST-ACK&quot;, &quot;CLOSED&quot;]
</code></pre>

<p>Which is super nice. &lt;3</p>

<p>I also talked with Mary about redesigning the <code>handle()</code> function I complained
about yesterday, but I still haven&rsquo;t had the courage to change it again. It
will happen!</p>

<p>##Floats!</p>

<p>In the afternoon, there was a fantastic lecture by <a href="http://karpinski.org/">Stefan Karpinski</a> about
floats. The key thing I learned there is that there are a finite amount of
64-bit floats (2^64 of them!). Which is obvious in retrospect, but I hadn&rsquo;t
thought about it before.</p>

<p>And there are always 2^52 floats between 2^n and 2^(n+1). Which is super nice!
In particular, this means that the floats between 2^52 and 2^53 are the same as
the integers between 2^52 and 2^53.</p>

<p>We talked about gradual underflow and epsilons and rounding and it was
fantastic. knowledge++.</p>

<p>##Visualizing Git workflows</p>

<p>I talked to <a href="http://pgbovine.net/">Philip Guo</a>, the resident for this week, for
a while. We played with the idea of taking people&rsquo;s history files and using them
to</p>

<ul>
<li>teach novices (so they can see what an expert workflow looks like)</li>
<li>help tool authors (so they can see how people are actually using their tools)</li>
<li>help me understand how I am using a tool</li>
<li>let me see how Wes McKinney uses pandas (celebrity history files! :D)</li>
</ul>

<p>We talked in particular about looking at</p>

<ul>
<li>Git workflows (because there are tons of options)</li>
<li>command line options in general for complex commands (<a href="http://explainshell.com/">http://explainshell.com/</a> is great, but it doesn&rsquo;t tell you which options you <em>should</em> be using)</li>
<li>IPython magics</li>
<li>IPython histories more generally, since they&rsquo;re all stored.</li>
</ul>

<p>I find it really interesting how I learn about command line tools largely
through social interactions and folklore, and rarely by reading documentation
or man pages.</p>

<p>A great example of a novice-teaching session
is <a href="https://gist.github.com/jvns/7460709">this part of my history file</a>, from
when I was pairing with Jari who understands tools like netstat and tcpdump. I
don&rsquo;t necessarily remember what all the options do, but since I have that
history I can refer back to it and read up on <code>-a</code>, <code>-n</code>, <code>-u</code>, and <code>-p</code>, which
is much more manageable than reading the <code>netstat</code> man page.</p>

<p>After we talked, I put together a graph of which Git commands I transition to
from other commands. The thickness of the arrow indicates how many times I move
from one command to another. There isn&rsquo;t really enough data to make conclusions
from this, but it&rsquo;s neat.</p>

<p>You can <a href="http://nbviewer.ipython.org/7460616">look at the notebook</a> and try it
out yourself. Here&rsquo;s the picture!</p>

<p><img src="/images/git-workflow.png"></p>

<p>##Takeaway</p>

<p>I need to talk to more people. I learn more when I talk to more people.</p>

</div>
<footer>
<div class="sharing">
<a href="http://twitter.com/share" class="twitter-share-button" data-url="https://jvns.ca/blog/2013/11/13/day-27-magic-testing-functions/" data-via="b0rk" data-counturl="https://jvns.ca/blog/2013/11/13/day-27-magic-testing-functions/">Tweet</a>
</div>
<p class="meta">
   
    <a class="basic-alignment left" href="https://jvns.ca/blog/2013/11/15/day-28-more-git-workflow-pictures/" title="Previous Post: Day 28: Made a git workflow visualization webapp!">Day 28: Made a git workflow visualization webapp!</a>
  
   
    <a class="basic-alignment right" href="https://jvns.ca/blog/2013/11/12/day-25-ack-all-the-things/" title="Previous Post: Day 25: ACK all the things">Day 25: ACK all the things</a>
  
</p>
</footer>
</article>
</div>

</div>
</div>
<nav role="navigation" class="footer-nav"> <a href="/">Archives</a>
</nav>
<footer role="contentinfo"><span class="credit">&copy; 2016 Polina Soshnin.
</footer>
</div>
</body>
</html>

