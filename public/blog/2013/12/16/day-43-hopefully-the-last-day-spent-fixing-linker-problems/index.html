
<!DOCTYPE html>


<html class="no-js" lang="en">
<head>
<meta charset="utf-8">
<title>Day 43: SOMETHING IS ERASING MY PROGRAM WHILE IT’S RUNNING (oh wait oops) - Polina Soshnin</title>
<meta name="author" content="Julia Evans">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="description" content="Day 43: SOMETHING IS ERASING MY PROGRAM WHILE IT’S RUNNING (oh wait oops)">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="canonical" href="https://jvns.ca/blog/2013/12/16/day-43-hopefully-the-last-day-spent-fixing-linker-problems/">
<link href="/favicon.ico" rel="icon">
<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
<link href="/atom.xml" rel="alternate" title="Julia Evans" type="application/atom+xml">
 
<link href="https://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='https://fonts.googleapis.com/css?family=Montserrat:700,400' rel='stylesheet' type='text/css'>
<link href='https://fonts.googleapis.com/css?family=Alegreya:400,900,700' rel='stylesheet' type='text/css'>
</head>
<body>
<div id="wrap">
<header role="banner">
<hgroup>
<h1><a href="/">Polina Soshnin</a></h1>
</hgroup>
<ul class="header-links">
<span><li><a href="/about">About</a></li>
<li><a href="/projects">Projects</a></li></span>
    <li><a href="https://github.com/polinadotio">Github</a></li></span>
    <li><a href="https://www.linkedin.com/in/polinasoshnin">LinkedIn</a></li></span>
</ul>
</header>
<nav role="navigation" class="header-nav"><ul class="main-navigation">
<li><a href="/categories/favorite/">Favorites</a></li>
<li><a href="/zines">Zines</a></li>
</ul>
</nav>
<div id="main">
<div id="content">

<div>
<article class="hentry" role="article">
<header>
<h1 class="entry-title">Day 43: SOMETHING IS ERASING MY PROGRAM WHILE IT’S RUNNING (oh wait oops)</h1>

<div class="post-tags">
  
  •
  
    <a class="post-tag" href="/categories/hackerschool">hackerschool</a> 	•
  
    <a class="post-tag" href="/categories/kernel">kernel</a> 	•
  
    <a class="post-tag" href="/categories/favorite">favorite</a> 	•
  
  
</div>
<p class="meta">
<time datetime="2013-12-16T00:00:00" pubdate data-updated="true"></time>
</p>
</header>
<div class="entry-content">
     <p>alternate title: &ldquo;Hopefully the last day I spend all day trying to
compile my code properly&rdquo;</p>

<p>(context: I&rsquo;m working on writing an OS, and am experiencing a
mysterious recurring bug. After many days, I have found the reason!)</p>

<p>Today I went through the following:</p>

<ol>
<li>Decide to try to write some code</li>
<li>Upgrade Rust, since my version is 8 days old</li>
<li>Oh no, the new Rust breaks my oldish version of <a href="http://github.com/thestinger/rust-core">rust-core</a></li>
<li>Upgrade rust-core</li>
<li>Oh no, the new rust-core requires me to compile in a different way</li>
<li>Spend a bunch of time messing with <code>clang</code> and friends to get
everything to compile again</li>
<li>Everything compiles. Yay!</li>
<li>Try to run code</li>
<li>Encounter mystery bug again, where my array mysteriously contains
0s instead of its actual contents</li>
<li>Make sad faces</li>
<li>Go talk to <a href="http://akaptur.github.io">Allison</a>. Allison is the best.</li>
<li>Allison asks: &ldquo;What linker debugging strategies do you have?&rdquo;

<ol>
<li>Change the linker script randomly (actual thing that has worked)</li>
<li>Change variable attributes from &lsquo;private&rsquo; to &lsquo;public&rsquo; at random
(actual other thing that has worked)</li>
<li>Look at the linker map or symbol table (not helpful, so far)</li>
<li>Attach gdb to qemu and inspect the contents of memory (!!!)</li>
</ol></li>
</ol>

<p>gdb is great. It let me</p>

<ul>
<li>search my memory for &ldquo;QWERTY&rdquo; (not there! why not?)</li>
<li>look at the memory at a given address (lots of zeros! huh!)</li>
<li>Do a core dump, and compare it to the original file. Lots of zeros!
Why is half my program gone?</li>
</ul>

<p>SURPRISE MY CODE IS NOT WORKING BECAUSE SOMETHING IS ERASING IT.</p>

<p>Can we talk about this?</p>

<ol>
<li>I have code</li>
<li>I can compile my code</li>
<li>Half of my binary gets overwritten with 0s at runtime. Why. What
did I do to deserve this?</li>
<li>No wonder the order I put the binary in matters.</li>
</ol>

<p>It is a wonder that this code even runs, man. Man.</p>

<p><strong>Edit</strong>: I found why my binary has lots of 0s in it at runtime. It is
  because I was only loading 12k of it in <code>loader.asm</code>. Hopefully this
  will serve as a lesson to someone.</p>

</div>
<footer>
<div class="sharing">
<a href="http://twitter.com/share" class="twitter-share-button" data-url="https://jvns.ca/blog/2013/12/16/day-43-hopefully-the-last-day-spent-fixing-linker-problems/" data-via="b0rk" data-counturl="https://jvns.ca/blog/2013/12/16/day-43-hopefully-the-last-day-spent-fixing-linker-problems/">Tweet</a>
</div>
<p class="meta">
   
    <a class="basic-alignment left" href="https://jvns.ca/blog/2013/12/17/day-44-gdb-is-great/" title="Previous Post: Day 44: qemu &#43; gdb = so great">Day 44: qemu &#43; gdb = so great</a>
  
   
    <a class="basic-alignment right" href="https://jvns.ca/blog/2013/12/13/day-42-how-to-run-an-elf-executable-i-dont-know/" title="Previous Post: Day 42: How to run a simple ELF executable, from scratch (I don&#39;t know)">Day 42: How to run a simple ELF executable, from scratch (I don&#39;t know)</a>
  
</p>
</footer>
</article>
</div>

</div>
</div>
<nav role="navigation" class="footer-nav"> <a href="/">Archives</a>
</nav>
<footer role="contentinfo"><span class="credit">&copy; 2016 Polina Soshnin.
</footer>
</div>
</body>
</html>

