
<!DOCTYPE html>


<html class="no-js" lang="en">
<head>
<meta charset="utf-8">
<title>Day 44: qemu &#43; gdb = so great - Polina Soshnin</title>
<meta name="author" content="Julia Evans">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="description" content="Day 44: qemu &#43; gdb = so great">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="canonical" href="https://jvns.ca/blog/2013/12/17/day-44-gdb-is-great/">
<link href="/favicon.ico" rel="icon">
<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
<link href="/atom.xml" rel="alternate" title="Julia Evans" type="application/atom+xml">
 
<link href="https://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='https://fonts.googleapis.com/css?family=Montserrat:700,400' rel='stylesheet' type='text/css'>
<link href='https://fonts.googleapis.com/css?family=Alegreya:400,900,700' rel='stylesheet' type='text/css'>
</head>
<body>
<div id="wrap">
<header role="banner">
<hgroup>
<h1><a href="/">Polina Soshnin</a></h1>
</hgroup>
<ul class="header-links">
<span><li><a href="/about">About</a></li>
<li><a href="/projects">Projects</a></li></span>
    <li><a href="https://github.com/polinadotio">Github</a></li></span>
    <li><a href="https://www.linkedin.com/in/polinasoshnin">LinkedIn</a></li></span>
</ul>
</header>
<nav role="navigation" class="header-nav"><ul class="main-navigation">
<li><a href="/categories/favorite/">Favorites</a></li>
<li><a href="/zines">Zines</a></li>
</ul>
</nav>
<div id="main">
<div id="content">

<div>
<article class="hentry" role="article">
<header>
<h1 class="entry-title">Day 44: qemu &#43; gdb = so great</h1>

<div class="post-tags">
  
  •
  
    <a class="post-tag" href="/categories/hackerschool">hackerschool</a> 	•
  
    <a class="post-tag" href="/categories/kernel">kernel</a> 	•
  
    <a class="post-tag" href="/categories/spytools">spytools</a> 	•
  
  
</div>
<p class="meta">
<time datetime="2013-12-17T00:00:00" pubdate data-updated="true"></time>
</p>
</header>
<div class="entry-content">
     <p>Today I did some more debugging and cleaning up. Previously I was
setting up my IDT (interrupt descriptor table) with assembly, but I
wanted to do it with Rust, because I don&rsquo;t really know assembly and
the less of it I have in my OS, the less of a liability it is. I&rsquo;d
tried to do this before, but it wasn&rsquo;t working.</p>

<p>What turned out to be wrong:</p>

<ul>
<li>I had <code>1 &lt;&lt; 16 - 1</code> instead of <code>(1 &lt;&lt; 16) - 1</code>, so my mask wasn&rsquo;t
working properly</li>
<li>I had the wrong function name for the interrupt handler</li>
<li>That was it!</li>
</ul>

<p>This actually ended up being really easy to debug! &ldquo;Really easy&rdquo; as in
&ldquo;it took all day, but I did not feel like hiding under the table at
any point&rdquo;. I have a symbol table, and <code>idt</code> is in it, so I just
needed to do iterations on</p>

<pre><code>gdb) x/4x &amp;idt
</code></pre>

<p>and compare the contents of memory from Working Code with the
Non-Working Code.</p>

<p><code>x/</code> means &ldquo;examine&rdquo;, and <code>4x</code> means &ldquo;as hex, 4 times`. Here&rsquo;s some
<a href="https://sourceware.org/gdb/onlinedocs/gdb/Memory.html">documentation for examining memory</a>.</p>

<p>Comparing sections of memory and figuring out why they&rsquo;re wrong is
tedious, but pretty straightforward &ndash; I had a good handle on what
all my code was doing. Pretty exciting. Best friends, gdb.</p>

<p><code>gdb</code> isn&rsquo;t totally the best interface &ndash; I can certainly imagine
having better ones. But it is Very Useful. So far I know how to</p>

<ul>
<li>Find the address of a symbol in memory</li>
<li>Look at memory (as ints, as hex, as ASCII)</li>
<li>Search memory</li>
<li>Set breakpoints (and look at assembly that I don&rsquo;t understand)</li>
<li>Make core dumps to look at later</li>
</ul>

<p>These are pretty awesome superpowers already, and I&rsquo;m sure there are
tons more.</p>

<p>So now my interrupt handlers are set up in Rust! This will make it
much easier for me to implement <code>int 80</code>, and therefore move towards
being able to run programs! Excellent! Onwards!</p>

</div>
<footer>
<div class="sharing">
<a href="http://twitter.com/share" class="twitter-share-button" data-url="https://jvns.ca/blog/2013/12/17/day-44-gdb-is-great/" data-via="b0rk" data-counturl="https://jvns.ca/blog/2013/12/17/day-44-gdb-is-great/">Tweet</a>
</div>
<p class="meta">
   
    <a class="basic-alignment left" href="https://jvns.ca/blog/2013/12/19/day-45-reading-elf-headers/" title="Previous Post: Day 45: I now have Rust code for executing executables!">Day 45: I now have Rust code for executing executables!</a>
  
   
    <a class="basic-alignment right" href="https://jvns.ca/blog/2013/12/16/day-43-hopefully-the-last-day-spent-fixing-linker-problems/" title="Previous Post: Day 43: SOMETHING IS ERASING MY PROGRAM WHILE IT’S RUNNING (oh wait oops)">Day 43: SOMETHING IS ERASING MY PROGRAM WHILE IT’S RUNNING (oh wait oops)</a>
  
</p>
</footer>
</article>
</div>

</div>
</div>
<nav role="navigation" class="footer-nav"> <a href="/">Archives</a>
</nav>
<footer role="contentinfo"><span class="credit">&copy; 2016 Polina Soshnin.
</footer>
</div>
</body>
</html>

