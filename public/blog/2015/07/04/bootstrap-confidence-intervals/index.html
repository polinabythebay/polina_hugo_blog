
<!DOCTYPE html>


<html class="no-js" lang="en">
<head>
<meta charset="utf-8">
<title>Some easy statistics: Bootstrap confidence intervals - Polina Soshnin</title>
<meta name="author" content="Julia Evans">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="description" content="Some easy statistics: Bootstrap confidence intervals">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="canonical" href="https://jvns.ca/blog/2015/07/04/bootstrap-confidence-intervals/">
<link href="/favicon.ico" rel="icon">
<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
<link href="/atom.xml" rel="alternate" title="Julia Evans" type="application/atom+xml">
 
<link href="https://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='https://fonts.googleapis.com/css?family=Montserrat:700,400' rel='stylesheet' type='text/css'>
<link href='https://fonts.googleapis.com/css?family=Alegreya:400,900,700' rel='stylesheet' type='text/css'>
</head>
<body>
<div id="wrap">
<header role="banner">
<hgroup>
<h1><a href="/">Polina Soshnin</a></h1>
</hgroup>
<ul class="header-links">
<span><li><a href="/about">About</a></li>
<li><a href="/projects">Projects</a></li></span>
    <li><a href="https://github.com/polinadotio">Github</a></li></span>
    <li><a href="https://www.linkedin.com/in/polinasoshnin">LinkedIn</a></li></span>
</ul>
</header>
<nav role="navigation" class="header-nav"><ul class="main-navigation">
<li><a href="/categories/favorite/">Favorites</a></li>
<li><a href="/zines">Zines</a></li>
</ul>
</nav>
<div id="main">
<div id="content">

<div>
<article class="hentry" role="article">
<header>
<h1 class="entry-title">Some easy statistics: Bootstrap confidence intervals</h1>

<div class="post-tags">
  
  •
  
    <a class="post-tag" href="/categories/machinelearning">machinelearning</a> 	•
  
  
</div>
<p class="meta">
<time datetime="2015-07-04T17:40:40" pubdate data-updated="true"></time>
</p>
</header>
<div class="entry-content">
     

<p><small>I am not actually on a plane to Puerto Rico, but I wrote this post when I was :)</small></p>

<p>Hey friends! I am on a plane to Puerto Rico right now. When is a better time to think about statistics?</p>

<p>We&rsquo;ll start with a confession: I analyze data, and I rarely think about what the underlying distribution of my data is. When I tell my awesome stats professor friend this, she kind of sighs, laughs, and says some combination of</p>

<ul>
<li>&ldquo;oh, machine learning people&hellip;&rdquo;</li>
<li>&ldquo;well, you have a lot of data so it probably won&rsquo;t kill you&rdquo;</li>
<li>&ldquo;but be careful of {lots of things that could hurt you}!&rdquo;</li>
</ul>

<p>So let&rsquo;s talk about being careful! One way to be careful is, when you come up with a number, to build a confidence interval about how sure you are about that number. I think the normal way to do confidence intervals is that you use Actual Statistics and know what your distribution is. But we&rsquo;re not going to do that because I&rsquo;m on a plane and I don&rsquo;t know what any of my distributions are. (the technical term for not knowing your distributions is &ldquo;nonparametric statistics&rdquo; :D)</p>

<p>So, let&rsquo;s say I have some numbers like: 0, 1, 3, 2, 8, 2, 3, 4 describing the number of no-shows for flights from New York to Puerto Rico. And that I also have no idea what kind of distribution this number should have, but some Important Person is asking me how much it&rsquo;s okay to oversell the plane by.</p>

<p>And let&rsquo;s say I think it&rsquo;s okay to have to kick people off the flight, say, 5% of the time. Great! Let&rsquo;s take the 5th percentile!</p>

<pre><code>&gt; np.percentile([0, 1, 3, 2, 8, 2, 3, 4], 5)
0.35000000000000003
</code></pre>

<p>Uh, great. the 5th percentile is there will be 0.35 people who don&rsquo;t make the plane. This is a) not really something I can take to management, and b) I have no idea how much confidence I should have in that estimate, given that I only have 8 data points. And I have no distribution to use to reason about it.</p>

<p>Maybe I <em>shouldn&rsquo;t</em> have switched to CS so I didn&rsquo;t have to take statistics (true story). Or alternatively maybe I can BOOTSTRAP MY WAY TO A CONFIDENCE INTERVAL WITH COMPUTERS. If you&rsquo;re paying close attention, this is like the <a href="http://jvns.ca/blog/2015/02/06/a-a-testing/">A/A testing</a> post I wrote a while back, but a more robust method.</p>

<p>The way you bootstrap is to sample with replacement from your data a lot of times (like 10000). So if you start with [1,2,3], you&rsquo;d sample [1,2,2], [1,3,3], [3,3,1], [1,3,2], etc. Then you compute your target statistic on your new datasets. So if you were taking the maximum, you&rsquo;d get 2,3,3,3, etc. This is great because you can use any statistic you want!</p>

<p>Here is some code to do that! <code>n_bootstraps</code> is intended to be a big number. I chose 10000 because I didn&rsquo;t want to wait more than a few seconds. More is always better.</p>

<pre><code class="language-python">    from sklearn.utils import resample
    def bootstrap_5th_percentile(data, n_bootstraps):
        bootstraps = []
        for _ in xrange(n_bootstraps):
            # Sample with replacement from data
            samples = resample(data)
            # Then we take the fifth percentile!
            bootstraps.append(np.percentile(samples, 5))
        return pd.Series(bootstraps)
</code></pre>

<p>So, let&rsquo;s graph it</p>

<pre><code class="language-python">    data = [0, 1, 3, 2, 8, 2, 3, 4]
    bootstraps = bootstrap_5th_percentile(data, 10000)
    bootstraps.hist()
</code></pre>

<p><img src="/images/bootstrap%20fun_6_2.png" alt="png" /></p>

<p>This is actually way more useful! It&rsquo;s telling me I can oversell by 0 - 2 people, and I don&rsquo;t have enough data to decide which one. I don&rsquo;t know if I&rsquo;d take this graph to airline executives (though everyone loves graphs right?!?!), but it&rsquo;s for sure more useful than just a 0.35.</p>

<p>Thankfully in real life I would probably have more flights than just 8 to use to make this decision. Let&rsquo;s say I actually had, like, 1000! Let&rsquo;s start by generating some data:</p>

<pre><code>data = np.random.normal(5, 2, 1000)
data = np.round(data[data &gt;= 0]).astype(int)
</code></pre>

<p>Here&rsquo;s a histogram of that data:</p>

<pre><code>pd.Series(data).hist()
</code></pre>

<p><img src="/images/bootstrap%20fun_10_1.png" alt="png" /></p>

<p>Now let&rsquo;s take the 5th percentile!</p>

<pre><code>np.percentile(data, 5)
2.0
</code></pre>

<p>Again, I don&rsquo;t really feel good about this number. How do I know I can trust this more than the 0.35 from before? Let&rsquo;s bootstrap it!</p>

<pre><code>bootstraps = bootstrap_5th_percentile(data, 10000)
bootstraps.value_counts().sort_index().plot(kind='bar')
</code></pre>

<p><img src="/images/bootstrap%20fun_14_1.png" alt="png" /></p>

<p>I feel a little better about calling it at 2 here.</p>

<h2 id="the-math">The math</h2>

<p>I have not explained ANY of the math behind why you should believe this is a reasonable approach, which if you are like me then you are super uncomfortable right now. For instance, obviously if I only have 1 data point, sampling with replacement isn&rsquo;t going to help me build a confidence interval. But what if I have 2 points, or 5? Why should you take these histograms I&rsquo;m building seriously at all? And what&rsquo;s this business with not even caring about what distribution you&rsquo;re using?</p>

<p>All worthwhile questions that we will not answer here today :).</p>

<h2 id="be-careful">Be careful</h2>

<p>If occasionally 100 people don&rsquo;t make the flight because they&rsquo;re all from the same group and that&rsquo;s important and not represented in your sample, bootstrapping can&rsquo;t save you.</p>

<p>This method is the bomb though. It is basically the only way I know to get error bars on my estimates and it works great.</p>

</div>
<footer>
<div class="sharing">
<a href="http://twitter.com/share" class="twitter-share-button" data-url="https://jvns.ca/blog/2015/07/04/bootstrap-confidence-intervals/" data-via="b0rk" data-counturl="https://jvns.ca/blog/2015/07/04/bootstrap-confidence-intervals/">Tweet</a>
</div>
<p class="meta">
   
    <a class="basic-alignment left" href="https://jvns.ca/blog/2015/07/25/an-argument-for-hiring-junior-developers/" title="Previous Post: An argument for hiring junior developers">An argument for hiring junior developers</a>
  
   
    <a class="basic-alignment right" href="https://jvns.ca/blog/2015/04/15/adacamp-montreal-2015/" title="Previous Post: AdaCamp Montreal 2015">AdaCamp Montreal 2015</a>
  
</p>
</footer>
</article>
</div>

</div>
</div>
<nav role="navigation" class="footer-nav"> <a href="/">Archives</a>
</nav>
<footer role="contentinfo"><span class="credit">&copy; 2016 Polina Soshnin.
</footer>
</div>
</body>
</html>

