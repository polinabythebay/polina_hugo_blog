
<!DOCTYPE html>


<html class="no-js" lang="en">
<head>
<meta charset="utf-8">
<title>A few spy tools for your operating system (other than strace!) - Polina Soshnin</title>
<meta name="author" content="Julia Evans">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="description" content="A few spy tools for your operating system (other than strace!)">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="canonical" href="https://jvns.ca/blog/2015/04/06/a-few-spy-tools-for-your-operating-system-other-than-strace/">
<link href="/favicon.ico" rel="icon">
<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
<link href="/atom.xml" rel="alternate" title="Julia Evans" type="application/atom+xml">
 
<link href="https://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='https://fonts.googleapis.com/css?family=Montserrat:700,400' rel='stylesheet' type='text/css'>
<link href='https://fonts.googleapis.com/css?family=Alegreya:400,900,700' rel='stylesheet' type='text/css'>
</head>
<body>
<div id="wrap">
<header role="banner">
<hgroup>
<h1><a href="/">Polina Soshnin</a></h1>
</hgroup>
<ul class="header-links">
<span><li><a href="/about">About</a></li>
<li><a href="/projects">Projects</a></li></span>
    <li><a href="https://github.com/polinadotio">Github</a></li></span>
    <li><a href="https://www.linkedin.com/in/polinasoshnin">LinkedIn</a></li></span>
</ul>
</header>
<nav role="navigation" class="header-nav"><ul class="main-navigation">
<li><a href="/categories/favorite/">Favorites</a></li>
<li><a href="/zines">Zines</a></li>
</ul>
</nav>
<div id="main">
<div id="content">

<div>
<article class="hentry" role="article">
<header>
<h1 class="entry-title">A few spy tools for your operating system (other than strace!)</h1>

<div class="post-tags">
  
  •
  
    <a class="post-tag" href="/categories/spytools">spytools</a> 	•
  
    <a class="post-tag" href="/categories/strace">strace</a> 	•
  
  
</div>
<p class="meta">
<time datetime="2015-04-06T22:30:02" pubdate data-updated="true"></time>
</p>
</header>
<div class="entry-content">
     <p>There are <em>so many</em> awesome tools you can use to find out what&rsquo;s going on with
your computer. Here are some that exist on Linux. They might exist on your OS
too!</p>

<h3 id="netstat">netstat</h3>

<p>netstat tells you what ports are open on your computer. This is crazy useful if
you want to know if the service that is <em>supposed</em> to be listening on port 8080
is <em>actually</em> listening on port 8080.</p>

<pre><code>sudo netstat -tulpn
[sudo] password for bork: 
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address       Foreign Address     State       PID/Program name
tcp        0      0 127.0.0.1:631       0.0.0.0:*           LISTEN      1658/cupsd      
tcp        0      0 127.0.0.1:5432      0.0.0.0:*           LISTEN      1823/postgres   
tcp        0      0 127.0.0.1:6379      0.0.0.0:*           LISTEN      2516/redis-server
</code></pre>

<p>If you look at the Program Name column on the right, you&rsquo;ll see that
apparently I have cupsd (printing), postgres, and redis servers running
on my machine, as well as some other stuff that I redacted. I actually
have no idea why I had redis installed so uh yeah I uninstalled it.</p>

<p>I use netstat pretty often when I&rsquo;m trying to debug &ldquo;omg why is this
thing not running IT IS SUPPOSED TO BE RUNNING&rdquo;. netstat tells me the
truth about whether it is running.</p>

<p></p>

<h3 id="dstat">dstat</h3>

<p>Want to know how much data is actually being written to your physical hard
drive right this second? YEAH YOU DO. dstat knows that. It prints a row every
second with stats for that second. I love dstat because it&rsquo;s so simple.</p>

<pre><code>----total-cpu-usage---- -dsk/total- -net/total- ---paging-- ---system--
usr sys idl wai hiq siq| read  writ| recv  send|  in   out | int   csw 
 32  38  30   0   0   0|  28k   81k|   0     0 |   4B  123B| 441  2184 
 12  29  59   0   0   0|   0   184k|  66B   86B|   0     0 |1428  6031 
  9  26  65   0   0   0|   0   576k| 518B  528B|   0     0 |1157  4611 
  9  25  66   0   0   0|   0   144k|   0     0 |   0     0 |1100  5249 
 14  27  59   0   0   0|   0     0 |  60B    0 |   0     0 |1001  4285 
  9  29  62   0   0   0|   0   180k| 122B   82B|   0     0 |1166  5416
</code></pre>

<h3 id="lsof">lsof</h3>

<p>lsof tells you which files every process has open right now! That&rsquo;s all!
It is awesome the same way dstat and netstat are awesome &ndash; you want to
know what files are open right now, it tells you what files are open
right now, you&rsquo;re done &lt;3.</p>

<p>It can also tell you what position in the file the process is at, so you
can find out what kind of progress it&rsquo;s making reading the file.</p>

<h3 id="ngrep-tcpdump">ngrep / tcpdump</h3>

<p>Okay now we&rsquo;re moving from &ldquo;super simple tool that does one thing&rdquo; to
&ldquo;tcpdump that has a billion options and also this whole BPF berkeley
packet filter business and what is this filter language even&rdquo;. So I&rsquo;m
not going to explain how to use tcpdump because I don&rsquo;t even really
know.</p>

<p>Let&rsquo;s say you want to</p>

<ul>
<li>reverse engineer a protocol</li>
<li>find out if there&rsquo;s <em>really</em> terrible latency or if everything is slow for some other reason</li>
<li>debug why your POST request is formatted wrong in a world before google chrome dev tools</li>
</ul>

<p>To do all of this, you need to spy on network activity! ngrep and tcpdump
capture packets, let you filter them, and show you what you&rsquo;re looking for. I&rsquo;m
not going to explain how to use them here but <a href="http://dl.packetstormsecurity.net/papers/general/ngreptut.txt">this ngrep tutorial</a> looks
pretty useful. If you&rsquo;re looking at output from tcpdump you should probably
dump it to a pcap file and use Wireshark to look at it instead. Wireshark is
the best and way easier to understand because it&rsquo;s a GUI and it makes
everything pretty for you.</p>

<p>as always with these systems tools, ngrep / tcpdump will tell you The Truth™
about what&rsquo;s going on on your network.</p>

<p>If you want to know how people use tcpdump, you should read <a href="https://twitter.com/b0rk/status/585234410980712448">the replies to this tweet &ldquo;do you use tcpdump in your day-to-day life? what do you use it for?&rdquo;</a> because the people
who follow me on twitter are the best. Really go read them! There is so much
interesting stuff there.</p>

<h3 id="opensnoop-ftrace">opensnoop &amp; ftrace</h3>

<p>Do you want to know every file your system is opening right now? There&rsquo;s a
script in Brendan Gregg&rsquo;s
<a href="https://github.com/brendangregg/perf-tools">perf-tools</a> collection that does
that!</p>

<p>I&rsquo;m mostly including this as an example to show that a lot of stuff is
<em>possible</em> to know &ndash; the scripts in that repo don&rsquo;t work with every Linux kernel
version (I needed to <a href="https://github.com/brendangregg/perf-tools/pull/24">modify it</a>
to get it to work with Linux 3.13). But they use a tracing framework in
the Linux kernel called &lsquo;ftrace&rsquo; that can tell you all <em>kinds</em> of stuff.</p>

<p>ftrace seems like quite a bit of work to learn how to use, but also really
powerful. Basically you access it by doing various things to files in
<code>/sys/kernel/debug/tracing</code>, or by using a wrapper command called
<code>trace-cmd</code>. It&rsquo;s all built into Linux!</p>

<h3 id="atop">atop</h3>

<p>atop is like top, but it shows you more stuff and you need to run it as
root. So it&rsquo;ll show me the CPU &amp; memory usage for each process, but also
how much disk &amp; network I/O it&rsquo;s doing. It&rsquo;s neat and a little
terrifying to look at at first (SO MANY NUMBERS).</p>

<h3 id="wow">wow</h3>

<p>That&rsquo;s all for now! If you have other tools you frequently reach for
when trying to figure out what&rsquo;s going on on your system, I&rsquo;d be
interested to know what they are. <a href="https://twitter.com/b0rk">@b0rk</a> on
Twitter, as always :)</p>

<p>an aside &ndash; I&rsquo;ve been thinking about man pages recently, and how you can
read the man page for tcpdump and understand individually all the words,
but it&rsquo;s not a substitute for someone telling you an Awesome Story about
how they used tcpdump to debug an intermittent certificate problem or a
DNS problem and then they Saved the Day.</p>
</div>
<footer>
<div class="sharing">
<a href="http://twitter.com/share" class="twitter-share-button" data-url="https://jvns.ca/blog/2015/04/06/a-few-spy-tools-for-your-operating-system-other-than-strace/" data-via="b0rk" data-counturl="https://jvns.ca/blog/2015/04/06/a-few-spy-tools-for-your-operating-system-other-than-strace/">Tweet</a>
</div>
<p class="meta">
   
    <a class="basic-alignment left" href="https://jvns.ca/blog/2015/04/12/learning-at-open-source-sprints/" title="Previous Post: Learning at open source sprints (no preparation required)">Learning at open source sprints (no preparation required)</a>
  
   
    <a class="basic-alignment right" href="https://jvns.ca/blog/2015/03/30/seeing-system-calls-with-perf-instead-of-strace/" title="Previous Post: Seeing system calls with perf instead of strace">Seeing system calls with perf instead of strace</a>
  
</p>
</footer>
</article>
</div>

</div>
</div>
<nav role="navigation" class="footer-nav"> <a href="/">Archives</a>
</nav>
<footer role="contentinfo"><span class="credit">&copy; 2016 Polina Soshnin.
</footer>
</div>
</body>
</html>

