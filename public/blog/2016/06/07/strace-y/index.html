
<!DOCTYPE html>


<html class="no-js" lang="en">
<head>
<meta charset="utf-8">
<title>A useful new strace feature - Polina Soshnin</title>
<meta name="author" content="Julia Evans">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="description" content="A useful new strace feature">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="canonical" href="https://jvns.ca/blog/2016/06/07/strace-y/">
<link href="/favicon.ico" rel="icon">
<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
<link href="/atom.xml" rel="alternate" title="Julia Evans" type="application/atom+xml">
 
<link href="https://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='https://fonts.googleapis.com/css?family=Montserrat:700,400' rel='stylesheet' type='text/css'>
<link href='https://fonts.googleapis.com/css?family=Alegreya:400,900,700' rel='stylesheet' type='text/css'>
</head>
<body>
<div id="wrap">
<header role="banner">
<hgroup>
<h1><a href="/">Polina Soshnin</a></h1>
</hgroup>
<ul class="header-links">
<span><li><a href="/about">About</a></li>
<li><a href="/projects">Projects</a></li></span>
    <li><a href="https://github.com/polinadotio">Github</a></li></span>
    <li><a href="https://www.linkedin.com/in/polinasoshnin">LinkedIn</a></li></span>
</ul>
</header>
<nav role="navigation" class="header-nav"><ul class="main-navigation">
<li><a href="/categories/favorite/">Favorites</a></li>
<li><a href="/zines">Zines</a></li>
</ul>
</nav>
<div id="main">
<div id="content">

<div>
<article class="hentry" role="article">
<header>
<h1 class="entry-title">A useful new strace feature</h1>

<div class="post-tags">
  
</div>
<p class="meta">
<time datetime="2016-06-07T19:52:40" pubdate data-updated="true"></time>
</p>
</header>
<div class="entry-content">
     

<p>I just upgraded my computer to Ubuntu 16.04, from 12.04. So, expect occasional updates on what has happened in the last 4 years since I am a computer dinosaur.</p>

<p>Now, as you all know, strace is my favorite program. So updates to my favorite program are EXTREMELY EXCITING.</p>

<p>When you run strace, you&rsquo;ll see a lot of lines like this:</p>

<pre><code>write(1, &quot;aio.h\t       btrfs\t   elf.h...&quot;) = 172
</code></pre>

<p>The number &ldquo;1&rdquo; is a <em>file descriptor</em>. Another thing that it is is NOT VERY INFORMATIVE. It&rsquo;s important to know about file descriptors, but when I tell people about strace, I always feel like it&rsquo;s kind of annoying! Why can&rsquo;t strace just tell me which file it wrote to, instead of hiding it behind some number?</p>

<p>WELL NOW IT CAN. There is a new flag: <code>-y</code>! Let&rsquo;s imagine we don&rsquo;t fully understand the difference between <code>cp</code> and <code>mv</code>, and we want to find out. For this task, I decided to copy a 1GB Ubuntu 16.04 ISO image from my desktop to <code>/tmp/blah</code>.</p>

<pre><code>strace -o out -y cp ubuntu-16.04-desktop-amd64.iso /tmp/blah 
</code></pre>

<p>Now let&rsquo;s see what it did! We still get to keep the file descriptors, but it appends the filename of the file it was reading from! Awesome! We can see that it&rsquo;s reading 128KB (128 * 1024 = 131072 bytes) at a time from the source file (<code>/home/bork/Desktop/ubuntu-16.04-desktop-amd64.iso</code>), and writing them into the destination file (<code>/tmp/blah</code>). Seems reasonable!</p>

<pre><code>read(3&lt;/home/bork/Desktop/ubuntu-16.04-desktop-amd64.iso&gt;, &quot;\315\350\5p\244\334\266\213 \2553~\37\7\330w\3125\316\360u\204P\236\255\n\244\344\264\327\213\241&quot;..., 131072) = 131072
write(4&lt;/tmp/blah&gt;, &quot;\315\350\5p\244\334\266\213 \2553~\37\7\330w\3125\316\360u\204P\236\255\n\244\344\264\327\213\241&quot;..., 131072) = 131072
read(3&lt;/home/bork/Desktop/ubuntu-16.04-desktop-amd64.iso&gt;, &quot;\37\367\336\377\247!\357\377\200\337wV\335\366|\232\337?\373iz\37r\376/z5\275\377\360\247\335&quot;..., 131072) = 131072
write(4&lt;/tmp/blah&gt;, &quot;\37\367\336\377\247!\357\377\200\337wV\335\366|\232\337?\373iz\37r\376/z5\275\377\360\247\335&quot;..., 131072) = 131072
read(3&lt;/home/bork/Desktop/ubuntu-16.04-desktop-amd64.iso&gt;, &quot;x\321/|'m\25\313o \261t^b\306\17r4~\3138j\6\4\244\3308\300E\366\364\22&quot;..., 131072) = 131072
write(4&lt;/tmp/blah&gt;, &quot;x\321/|'m\25\313o \261t^b\306\17r4~\3138j\6\4\244\3308\300E\366\364\22&quot;..., 131072) = 131072
read(3&lt;/home/bork/Desktop/ubuntu-16.04-desktop-amd64.iso&gt;, &quot;j\273\324\332\216\361\207\204\336\243\326\267\227\35\322\370\205\245N6+\211h\246\215\32k\336\0\r\320.&quot;..., 131072) = 131072
write(4&lt;/tmp/blah&gt;, &quot;j\273\324\332\216\361\207\204\336\243\326\267\227\35\322\370\
</code></pre>

<p>What about <code>mv ubuntu-16.04-desktop-amd64.iso ..</code>?  What does that do?</p>

<pre><code>rename(&quot;ubuntu-16.04-desktop-amd64.iso&quot;, &quot;../ubuntu-16.04-desktop-amd64.iso&quot;) = 0
</code></pre>

<p>That&rsquo;s just one system call! No wonder moving is so fast and copying is so slow :)</p>

<h3 id="usability-is-cool-and-yy">usability is cool (and, -yy!)</h3>

<p>I love seeing programs like strace get usability improvements! This is awesome. If you run strace with <code>-yy</code>, and you&rsquo;re doing networking, it&rsquo;ll resolve file descriptors into a source &amp; destination IP address and port, like this!</p>

<p>This is querying my DNS server on localhost for <code>blah.com</code> and getting no answer.</p>

<pre><code>$ strace -yy wget blah.com
recvfrom(3&lt;UDP:[127.0.0.1:46218-&gt;127.0.1.1:53]&gt;, &quot;\270\222\201\205\0\1\0\0\0\0\0\0\4blah\3com\0\0\1\0\1&quot;, 2048, 0, {sa_family=AF_INET, sin_port=htons(53), sin_addr=inet_addr(&quot;127.0.1.1&quot;)}, [16]) = 26
</code></pre>

</div>
<footer>
<div class="sharing">
<a href="http://twitter.com/share" class="twitter-share-button" data-url="https://jvns.ca/blog/2016/06/07/strace-y/" data-via="b0rk" data-counturl="https://jvns.ca/blog/2016/06/07/strace-y/">Tweet</a>
</div>
<p class="meta">
   
    <a class="basic-alignment left" href="https://jvns.ca/blog/2016/06/12/a-weird-system-call-process-vm-readv/" title="Previous Post: How to spy on a Ruby program">How to spy on a Ruby program</a>
  
   
    <a class="basic-alignment right" href="https://jvns.ca/blog/2016/06/06/make-better-conference-talks/" title="Previous Post: Ideas for making better conference talks &amp; conferences">Ideas for making better conference talks &amp; conferences</a>
  
</p>
</footer>
</article>
</div>

</div>
</div>
<nav role="navigation" class="footer-nav"> <a href="/">Archives</a>
</nav>
<footer role="contentinfo"><span class="credit">&copy; 2016 Polina Soshnin.
</footer>
</div>
</body>
</html>

